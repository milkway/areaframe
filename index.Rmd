---
title: "Tecnologias web para construção de cadastros de área em pesquisas agropecuárias"
author: André Leite, Cristiano Ferraz, and Raydonal Ospina 
output:
  rmdshower::shower_presentation:
    css: style-override.css
    theme: material
    self_contained: false
    katex: true
    ratio: 16x10
---

## {.off}

<canvas id="canvas" width ="400px" height="400px">
</canvas>

<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var radius = canvas.height / 2;
ctx.translate(radius, radius);
radius = radius * 0.90
setInterval(drawClock, 1000);

function drawClock() {
  drawFace(ctx, radius);
  drawNumbers(ctx, radius);
  drawTime(ctx, radius);
  drawDot(ctx);
}

function drawFace(ctx, radius) {
  ctx.beginPath();
  ctx.arc(0, 0, radius, 0, 2*Math.PI);
  ctx.fillStyle = "rgba(255, 255, 255)"; 
  //'white';
  ctx.fill();
  ctx.strokeStyle = 'MediumSeaGreen';
  ctx.lineWidth = radius*0.1;
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(0, 0, radius*0.1, 0, 2*Math.PI);
  ctx.fillStyle = 'green';
  ctx.fill();
}
function drawDot(ctx) {
  ctx.strokeStyle = 'black';
  ctx.lineWidth = radius*0.-5;
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(0, 0, radius*0.05, 0, 2*Math.PI);
  ctx.fillStyle = 'black';
  ctx.fill();
}
function drawNumbers(ctx, radius) {
  var ang;
  var num;
  ctx.font = radius*0.12 + "px Roboto Mono";
  ctx.textBaseline="middle";
  ctx.textAlign="center";
  for(num = 1; num < 13; num++){
    ang = num * Math.PI / 6;
    ctx.rotate(ang);
    ctx.translate(0, -radius*0.85);
    ctx.rotate(-ang);
    ctx.fillText(num.toString(), 0, 0);
    ctx.rotate(ang);
    ctx.translate(0, radius*0.85);
    ctx.rotate(-ang);
  }
}

function drawTime(ctx, radius){
    var now = new Date();
    var hour = now.getHours();
    var minute = now.getMinutes();
    var second = now.getSeconds();
    //hour
    hour=hour%12;
    hour=(hour*Math.PI/6)+
    (minute*Math.PI/(6*60))+
    (second*Math.PI/(360*60));
    drawHand(ctx, hour, radius*0.5, radius*0.07, '#588c7e');
    //minute
    minute=(minute*Math.PI/30)+(second*Math.PI/(30*60));
    drawHand(ctx, minute, radius*0.8, radius*0.07,'#d96459');
    // second
    second=(second*Math.PI/30);
    drawHand(ctx, second, radius*0.9, radius*0.02, '#f2e394');
}

function drawHand(ctx, pos, length, width, color) {
    ctx.beginPath();
    ctx.lineWidth = width;
    ctx.lineCap = "round";
    ctx.moveTo(0,0);
    ctx.rotate(pos);
    ctx.lineTo(0, -length);
    ctx.strokeStyle = color;
    ctx.stroke();
    ctx.rotate(-pos);
}
</script>



## Tecnologias web para construção de cadastros de área em pesquisas agropecuárias { .clear .boldtlt .off}


<img src="images/world2.png" class="cover height">

<p class="black">
**André Leite** (leite@castlab.org)
<br>
**Cristiano Ferraz** (cferraz@castlab.org)
<br>
**Raydonal Ospina** (raydonal@castlab.org)
</p>

##  
<h2 class="shout">CASTLab</h2>
<p>Test</p>


## CASTLab.org {.off}
<div
 style="padding-bottom:56.25%; position:relative; display:block; width: 100%; height=300px">
 <iframe style="border: none;"
  width="100%" height="400px"
  src="https://castlab.org"
  frameborder="0" allowfullscreen=""
  style="position:absolute; top:0; left: 0"></iframe>
</div>

##  
<h2 class="shout">Outline</h2>
<p>Test</p>

## Topics

<div style='float:left;width:48%;' class='centered'>

- Area frames
- Crowdsourcing
- `R`
- `Shiny`
- Infraestrutura
- Master Sampling Project

</div>
<div style='float:right;width:48%;margin-top:-100px;'>
```{r echo=FALSE, message=FALSE, out.height='420px', out.width='470px'}
library(tidyverse)
library(leaflet)
library(rgdal)
library(rgeos)
library(tibble)
library(leaflet)
library(htmltools)

tractsGoiana <- read_rds("data/tractsGoiana.rds")
segmentsGoiana <- read_rds("data/segmentsGoiana.rds")
goiana_points <- read_rds("data/goiana_points.rds")

points779 <- goiana_points %>% select(Segment, latitude, longitude, Reference, imageLatitude, imageLongitude) %>%  filter(Segment == 779)

 tractsGoiana@data  <- tractsGoiana@data %>%
   mutate(Label = paste("ID",ID, "Area: ", round(Area,1), "hec"))

leaflet() %>% addTiles() %>%
  addProviderTiles("Esri.WorldImagery", group = "WorldImagery") %>%
  addPolygons(data = tractsGoiana[tractsGoiana$Segment == "779",],
              color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5,
              fillColor = ~colorQuantile("YlOrRd", as.integer(Tract))(as.integer(Tract)),
              highlightOptions = highlightOptions(color = "white", weight = 2,
                                                  bringToFront = FALSE),
              label = ~Label,
               labelOptions = labelOptions(noHide = FALSE, opacity = .75, direction = "auto", offset = c(0, 0))) %>% # 90, 0
  addPolygons(data = segmentsGoiana["779",], popup = "Goiana Segment 779",
              fill = FALSE, weight = 4, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 1, color = "white", options = popupOptions(minWidth = 20, closeOnClick = FALSE, closeButton = FALSE)) %>%
  addCircles(data = points779, lng = ~longitude, lat = ~latitude, popup =~Reference, radius = 15, opacity =  1, color = "white") %>%
  addMarkers(data = points779, lng = ~as.numeric(imageLongitude), lat = ~as.numeric(imageLatitude), popup =~Reference)

```
</div>




##  
<h2 class="shout">Area Frames</h2>
<p>Test</p>


## Area Frames {.small-list}

<div style='float:left;width:65%;' class='centered'>

> 1. Sampling units can assume a variety of forms
> 2. Built upon GPS/GIS/Remote sensing type of data
> 3. <strong style="color:ForestGreen">Furnishes complete population coverage </strong>
> 4. <strong style="color:ForestGreen">Keeps updated over time </strong>
> 5. Provides indirect access to reporting units
> 6. <strong style="color:DeepSkyBlue ">Needs maintenance for stratification purposes  </strong>
> 7. <strong style="color:OrangeRed">High costs to build an area frame  </strong>
> 8. <strong style="color:OrangeRed">Finding reporting units can require high efforts </strong>

<blockquote>
  <p>Ferraz & Mecatti</p>
</blockquote>

</div>
<div style='float:right;width:35%;margin-top:0px;'>
```{r echo=FALSE, message=FALSE, out.height='300px', out.width='350px'}
goiana_grid <- read_rds("data/goiana_grid.rds")
goiana <- read_rds("data/goiana.rds")
goiana_grid %>% leaflet() %>%
  addTiles() %>%
  addPolygons(color = "#FF4500", weight = 1, fillOpacity = .1,
              highlightOptions = highlightOptions(color = "white", weight = 2,
                                                  bringToFront = FALSE),
              label = ~as.character(ID),
               labelOptions = labelOptions(noHide = FALSE, opacity = .75, direction = "auto", offset = c(0, 0))) %>% # 180, 60
  addPolygons(data = goiana, weight = 2, fill = FALSE, opacity = 1)

```
</div>

##  
<h2 class="shout">Crowdsourcing</h2>
<p>Test</p>

## Crowdsourcing

<p class="note">Definition</p>
<figure>
    <blockquote>
        <p>the practice of obtaining information or input into a task or project by enlisting the services of a large number of people, either paid or unpaid, typically via the Internet.</p>
    </blockquote>
    <figcaption>Oxford Dictionary (lexico.com)</figcaption>
</figure>

## Crowdsourcing (Google $1/4$) {.visited .active}

<div style="float:left;width:45%;margin-top:100px" class='centered'>
<img class="next" src="images/google1.png" width="400px">
</div>
<div style="float:right;width:45%;margin-top:100px">
<img class="next" src="images/google2.png" width="400px">
</div>

## Crowdsourcing (Google $2/4$) {.visited .active}

<div style='float:left;width:45%;' class='centered'>
<img class="next active" src="images/google3.png" height="25%">
</div>
<div style='float:right;width:45%;'>
<img class="next" src="images/google4.jpeg" width="400px">
</div>

## Crowdsourcing (Google $3/4$) {.visited .active .off}

<div style='float:left;width:48%;' class='centered'>
<img class="next active" src="images/google6.png" width="400px">
</div>
<div style='float:right;width:48%;'>
<img class="next" src="images/googleTemp6.jpg" width="300px">
</div>

## Crowdsourcing (Google $4/4$) {.visited .active}

<center>
<img src="images/google7.png" height="25%">
</center>

##  {.off}

<center>
<img src="images/R_logo.png" width="50%">
</center>

##  {.off}

<center>
<img src="images/RStudio-Logo.png" width="75%">
</center>

<div id="#flex-container" width="100%">
<div style='float:left;width:33%;padding-left:50px;padding-top:25px;margin:0;' class='flex-item'>
> - `leaflet`
> - `tidyverse`
</div>
<div style='float:left;width:33%;padding-left:50px;padding-top:25px;margin:0' class='flex-item'>
> - `RColorBrewer`
> - `rmarkdown`
</div>
<div style='float:left;width:33%;padding-left:50px;padding-top:25px;margin:0' class='flex-item'>
> - `rgdal`
> - `rgeos`
> - `sp` vs. `sf`
</div>
</div>

## {.off}

<center>
<img src="images/shiny.webp" class="cover height">
</center>

##  What is Shiny?

<div style='float:left;width:45%;' class='centered'>
<figure style="font-size:.9em;line-height:1.75">
    <blockquote>
        <p>Shiny is an <mark>R package</mark> that makes it easy to build interactive web apps straight from R. You can host standalone apps on a webpage or embed them in `R Markdown` documents or build dashboards. You can also extend your Shiny apps with <mark class="important">CSS themes, htmlwidgets, and JavaScript actions</mark>.</p>
    </blockquote>
    <figcaption>shiny.rstudio.com</figcaption>
</figure>
</div>
<div style='float:right;width:45%;'>
<img src="images/shiny_deck.png" width="400px">
</div>

## Shiny

<div style='float:left;width:48%;font-size:.75em' class='centered'>
<h3>`Server`</h3>
```{r eval=FALSE}

library(datasets)

# Define a server for the Shiny app
function(input, output) {
  
  # Fill in the spot we created for a plot
  output$phonePlot <- renderPlot({
    
    # Render a barplot
    barplot(
      WorldPhones[,input$region]*1000, 
            main=input$region,
            ylab="Number of Telephones",
            xlab="Year"
            )
  })
}
```
</div>
<div style='float:right;width:48%;font-size:.75em'>
<h3>`UI`</h3>
```{r eval=FALSE}
# Use a fluid Bootstrap layout
fluidPage(    
  # Give the page a title
  titlePanel("Telephones by region"),
  # Generate a row with a sidebar
  sidebarLayout(      
    # Define the sidebar with one input
    sidebarPanel(
      selectInput("region", "Region:", choices=colnames(WorldPhones)),
      hr(),
      helpText("Data from AT&T (1961) The World's Telephones.")
    ),
    # Create a spot for the barplot
    mainPanel(
      plotOutput("phonePlot")  
    ))
  )
```
</div>

## Shiny {.centered}

<img src="images/shiny_app.png" width="75%">

## From `Shiny Gallery`

<div
 style="padding-bottom:56.25%; position:relative; display:block; width: 100%; height=300px">
 <iframe style="border: 3px solid green;"
  width="100%" height="375px"
  src="https://shiny.rstudio.com/gallery/telephones-by-region.html"
  frameborder="0" allowfullscreen=""
  style="position:absolute; top:0; left: 0"></iframe>
</div>


## From `Shiny Gallery`

<div
 style="padding-bottom:56.25%; position:relative; display:block; width: 100%; height=300px">
 <iframe style="border: 3px solid green;"
  width="100%" height="375px"
  src="https://shiny.rstudio.com/gallery/superzip-example.html"
  frameborder="0" allowfullscreen=""
  style="position:absolute; top:0; left: 0"></iframe>
</div>

## Shout


<h2 class="shout">Infrastructure</h2>


## {.off}

<center>
<img src="images/ssdnodes.png" class="cover height">
</center>


## {.off}

<center>
<img src="images/do.png" class="cover height">
</center>


## {.off}

<center>
<img src="images/mlab.png">
</center>


## Shout

<h2 class="shout">Master Sampling Projetc</h2>


## **The End** { .white }

<img src="images/elchaiten.jpg" class="cover h">

<footer class="footer">
<p>Cosby sweater Shoreditch.</p>
</footer>

## Shout

<h2 class="shout">Questions?</h2>


## Grid { .grid }

## Note
<p class="double">
<p>Text</p>
<p class="note">Note</p>
<figure>
    <blockquote>
        <p>Post-ironic fashion axe flexitarian</p>
    </blockquote>
    <figcaption>Yours Truly</figcaption>
</figure>
</p>

## Shower

These slides use a template from the [shower](https://github.com/shower/shower)
presentation system. Notable features:

1. Works in all modern browsers
1. Presentation fully keyboard accessible
1. Multiple themes available
1. Printable to PDF

<p class="note"> Shower ['ʃəuə] noun. A person or thing that shows.</p>


## Formulas

Formulas are rendered by KaTeX, https://github.com/Khan/KaTeX

It supports both inline: \(y = x / 2\) and displayed formulas:

\[ x_{1,2} = \frac{- b \pm \sqrt{b^2 - 4ac}}{2a} \]

## Slide with quote

> The bad news is that when ever you learn a new skill you're going to
> suck. It's going to be frustrating. The good news is that is typical and
> happens to everyone and it is only temporary. You can't go from knowing
> nothing to becoming an expert without going through a period of great
> frustration and great suckiness.

**Hadley Wickham **

## Div Test

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">
- This is my first conclusion
- This is my second conclusion
</div>

## Kable test { .small-code }

```{r tables-mtcars}
library(DT)
datatable(mtcars, rownames = FALSE,
          filter="top",
          options = list(pageLength = 5, scrollX=TRUE) )
```

# Full Page Plots

## { .fullpage }

<div class="fullpage width">
```{r, echo=FALSE, dev='svg'}
par(mar = c(5, 4, 1, 2) + 0.1)
pairs(iris[1:4], pch = 21,
      bg = c("red", "green3", "blue")[unclass(iris$Species)])
```
</div>

